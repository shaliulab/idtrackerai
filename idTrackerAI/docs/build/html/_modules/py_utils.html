<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8">
    
    <title>py_utils &mdash; idtrackerai 0.0.1 documentation</title>
    
    <link rel="stylesheet" type="text/css" href="../_static/css/spc-bootstrap.css">
    <link rel="stylesheet" type="text/css" href="../_static/css/spc-extend.css">
    <link rel="stylesheet" href="../_static/scipy.css" type="text/css" >
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" >
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/copybutton.js"></script>
    <link rel="index" title="Index" href="../genindex.html" >
    <link rel="search" title="Search" href="../search.html" >
    <link rel="top" title="idtrackerai 0.0.1 documentation" href="../index.html" >
    <link rel="up" title="Module code" href="index.html" > 
  </head>
  <body>

<div class="container">
  <div class="top-scipy-org-logo-header">
    <a href="../index.html">
      <img style="border: 0;" alt="idtrackerai" src="../_static/img/idtracker_logo.gif"></a>
    </div>
  </div>
</div>


    <div class="container">
      <div class="main">
        
	<div class="row-fluid">
	  <div class="span12">
	    <div class="spc-navbar">
              
    <ul class="nav nav-pills pull-left">
        <li class="active"><a href="http://www.idtracker.ai">idtracker.ai</a></li>
        <li class="active"><a href="http://www.gitlab.com/polaviejalab/idtracker">GitLab</a></li>
	
        <li class="active"><a href="../index.html">idtrackerai 0.0.1 documentation</a></li>
	
          <li class="active"><a href="index.html" accesskey="U">Module code</a></li> 
    </ul>
              
              
    <ul class="nav nav-pills pull-right">
      <li class="active">
        <a href="../genindex.html" title="General Index"
           accesskey="I">index</a>
      </li>
      <li class="active">
        <a href="../py-modindex.html" title="Python Module Index"
           >modules</a>
      </li>
    </ul>
              
	    </div>
	  </div>
	</div>
        

	<div class="row-fluid">
      <div class="spc-rightsidebar span3">
        <div class="sphinxsidebarwrapper">
        </div>
      </div>
          <div class="span9">
            
        <div class="bodywrapper">
          <div class="body" id="spc-section-body">
            
  <h1>Source code for py_utils</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">groupby</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">cPickle</span> <span class="k">as</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="k">import</span> <span class="n">pprint</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="c1"># sys.path.append(&#39;../utils&#39;)</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;__main__.py_utils&quot;</span><span class="p">)</span>

<span class="c1">### Git utils ###</span>
<span class="k">def</span> <span class="nf">get_git_revision_hash</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;git&#39;</span><span class="p">,</span> <span class="s1">&#39;rev-parse&#39;</span><span class="p">,</span> <span class="s1">&#39;HEAD&#39;</span><span class="p">])</span>

<span class="c1">### Object utils ###</span>
<span class="k">def</span> <span class="nf">append_values_to_lists</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">list_of_lists</span><span class="p">):</span>
    <span class="n">list_of_lists_updated</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">list_of_lists</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">list_of_lists_updated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">list_of_lists_updated</span>

<span class="k">def</span> <span class="nf">set_attributes_of_object_to_value</span><span class="p">(</span><span class="n">object_to_modify</span><span class="p">,</span> <span class="n">attributes_list</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="p">[</span><span class="nb">setattr</span><span class="p">(</span><span class="n">object_to_modify</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">attributes_list</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">object_to_modify</span><span class="p">,</span> <span class="n">attribute</span><span class="p">)]</span>

<span class="k">def</span> <span class="nf">delete_attributes_from_object</span><span class="p">(</span><span class="n">object_to_modify</span><span class="p">,</span> <span class="n">list_of_attributes</span><span class="p">):</span>
    <span class="p">[</span><span class="nb">delattr</span><span class="p">(</span><span class="n">object_to_modify</span><span class="p">,</span> <span class="n">attribute</span><span class="p">)</span> <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">list_of_attributes</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">object_to_modify</span><span class="p">,</span> <span class="n">attribute</span><span class="p">)]</span>

<span class="c1">### Dict utils ###</span>
<div class="viewcode-block" id="getVarFromDict"><a class="viewcode-back" href="../index.html#py_utils.getVarFromDict">[docs]</a><span class="k">def</span> <span class="nf">getVarFromDict</span><span class="p">(</span><span class="n">dictVar</span><span class="p">,</span><span class="n">variableNames</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; get variables from a standard python dictionary &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">dictVar</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">variableNames</span><span class="p">]</span></div>

<span class="k">def</span> <span class="nf">maskArray</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span><span class="n">im2</span><span class="p">,</span><span class="n">w1</span><span class="p">,</span><span class="n">w2</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span><span class="n">w1</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">im2</span><span class="p">,</span><span class="n">w2</span><span class="p">))</span>

<div class="viewcode-block" id="flatten"><a class="viewcode-back" href="../index.html#py_utils.flatten">[docs]</a><span class="k">def</span> <span class="nf">flatten</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; flatten a list of lists &#39;&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="p">[</span><span class="n">inner</span> <span class="k">for</span> <span class="n">outer</span> <span class="ow">in</span> <span class="n">l</span> <span class="k">for</span> <span class="n">inner</span> <span class="ow">in</span> <span class="n">outer</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">l</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="p">(</span><span class="n">x</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="n">x</span><span class="p">,))]</span>
    <span class="k">return</span> <span class="n">ans</span></div>

<div class="viewcode-block" id="cycle"><a class="viewcode-back" href="../index.html#py_utils.cycle">[docs]</a><span class="k">def</span> <span class="nf">cycle</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; shift the list one element towards the right</span>
<span class="sd">    [a,b,c] -&gt; [c,a,b] &#39;&#39;&#39;</span>
    <span class="n">l</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">l</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">l</span></div>

<span class="k">def</span> <span class="nf">Ncycle</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">cycle</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">l</span>

<span class="k">def</span> <span class="nf">countRate</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
    <span class="c1"># count repetitions of each element in array and returns the multiset</span>
    <span class="c1"># (el, multiplicity(el))</span>
    <span class="c1"># [1,1,2,1] outputs [(1,2), (2,1), (1,1)]</span>
    <span class="k">return</span> <span class="p">[(</span><span class="n">key</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">group</span><span class="p">)))</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groupby</span><span class="p">(</span><span class="n">array</span><span class="p">)]</span>

<span class="k">def</span> <span class="nf">countRateSet</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
    <span class="c1"># count repetitions of each element in array, by summing the multiplicity of</span>
    <span class="c1"># identical components</span>
    <span class="c1"># [1,1,2,1] outputs [(1,3), (2,1)]</span>
    <span class="n">uniqueEl</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">array</span><span class="p">))</span>
    <span class="n">ratePerElement</span> <span class="o">=</span> <span class="p">[(</span><span class="n">key</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">group</span><span class="p">)))</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groupby</span><span class="p">(</span><span class="n">array</span><span class="p">)]</span>
    <span class="k">return</span> <span class="p">[(</span><span class="n">el</span><span class="p">,</span><span class="nb">sum</span><span class="p">([</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">ratePerElement</span> <span class="k">if</span> <span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span> <span class="n">el</span><span class="p">]))</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">uniqueEl</span><span class="p">]</span>

<div class="viewcode-block" id="groupByCustom"><a class="viewcode-back" href="../index.html#py_utils.groupByCustom">[docs]</a><span class="k">def</span> <span class="nf">groupByCustom</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">ind</span><span class="p">):</span> <span class="c1">#FIXME it can be done matricially</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    given an array to group and an array of keys returns the array grouped in a</span>
<span class="sd">    dictionary according to the keys listed at the index ind</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dictionary</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">array</span><span class="p">:</span>
        <span class="n">dictionary</span><span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="n">ind</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dictionary</span></div>

<span class="k">def</span> <span class="nf">deleteDuplicates</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
    <span class="c1"># deletes duplicate sublists in list</span>
    <span class="n">newArray</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">delInds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">elem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">elem</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">newArray</span><span class="p">:</span>
            <span class="n">newArray</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">delInds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">newArray</span><span class="p">,</span><span class="n">delInds</span>


<div class="viewcode-block" id="ssplit2"><a class="viewcode-back" href="../index.html#py_utils.ssplit2">[docs]</a><span class="k">def</span> <span class="nf">ssplit2</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span><span class="n">splitters</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    split a list at splitters, if the splitted sequence is longer than 1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">seq</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">splitters</span> <span class="ow">and</span> <span class="n">seq</span><span class="p">:</span>
        <span class="n">splitters</span><span class="o">=</span><span class="nb">set</span><span class="p">(</span><span class="n">splitters</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">splitters</span><span class="p">:</span>
            <span class="n">result</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">begin</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">for</span> <span class="n">end</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">seq</span><span class="p">[</span><span class="n">end</span><span class="p">]</span> <span class="ow">in</span> <span class="n">splitters</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">end</span> <span class="o">&gt;</span> <span class="n">begin</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">[</span><span class="n">begin</span><span class="p">:</span><span class="n">end</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seq</span><span class="p">[</span><span class="n">begin</span><span class="p">:</span><span class="n">end</span><span class="p">])</span>
                    <span class="n">begin</span><span class="o">=</span><span class="n">end</span><span class="o">+</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">begin</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seq</span><span class="p">[</span><span class="n">begin</span><span class="p">:])</span>
            <span class="k">return</span> <span class="n">result</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">seq</span><span class="p">]</span></div>

<span class="k">def</span> <span class="nf">natural_sort</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
    <span class="n">convert</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">text</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">else</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">alphanum_key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">key</span><span class="p">:</span> <span class="p">[</span> <span class="n">convert</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;([0-9]+)&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="p">]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="n">alphanum_key</span><span class="p">)</span>

<div class="viewcode-block" id="getSubfolders"><a class="viewcode-back" href="../index.html#py_utils.getSubfolders">[docs]</a><span class="k">def</span> <span class="nf">getSubfolders</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; returns subfolders of a given path&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">path</span><span class="p">))]</span></div>

<div class="viewcode-block" id="getFiles"><a class="viewcode-back" href="../index.html#py_utils.getFiles">[docs]</a><span class="k">def</span> <span class="nf">getFiles</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; returns files of a given path&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">name</span><span class="p">))]</span></div>

<div class="viewcode-block" id="getFilesAndSubfolders"><a class="viewcode-back" href="../index.html#py_utils.getFilesAndSubfolders">[docs]</a><span class="k">def</span> <span class="nf">getFilesAndSubfolders</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; returns files and subfodlers of a given path in two different lists&#39;&#39;&#39;</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">name</span><span class="p">))]</span>
    <span class="n">subfolders</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">name</span><span class="p">))]</span>
    <span class="k">return</span> <span class="n">files</span><span class="p">,</span> <span class="n">subfolders</span></div>

<span class="k">def</span> <span class="nf">scanFolder</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="c1">### NOTE if the video selected does not finish with &#39;_1&#39; the scanFolder function won&#39;t select all of them. This can be improved</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span>
    <span class="n">video</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">filename</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">video</span><span class="p">)</span>
    <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="c1"># maybe write check on video extension supported by opencv2</span>
    <span class="k">if</span> <span class="n">filename</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;_1&#39;</span><span class="p">:</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="n">natural_sort</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">filename</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">+</span> <span class="n">extension</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">paths</span>

<span class="k">def</span> <span class="nf">get_spaced_colors_util</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">norm</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">black</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;jet&#39;</span><span class="p">):</span>
    <span class="n">RGB_tuples</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">norm</span><span class="p">:</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">RGB_tuples</span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">RGB_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">RGB_tuples</span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)])</span>
        <span class="n">BRG_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">RGB_array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">BRG_array</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">RGB_array</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">BRG_array</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">RGB_array</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">BRG_array</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">RGB_array</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">BRG_array</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">*</span> <span class="mi">256</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">black</span><span class="p">:</span>
        <span class="n">black</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="n">colors</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">black</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">colors</span>

<span class="k">def</span> <span class="nf">saveFile</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">variabletoSave</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">hdfpkl</span> <span class="o">=</span> <span class="s1">&#39;hdf&#39;</span><span class="p">,</span><span class="n">sessionPath</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">nSegment</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">cPickle</span> <span class="k">as</span> <span class="nn">pickle</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    All the input are strings!!!</span>
<span class="sd">    path: path to the first segment of the video</span>
<span class="sd">    name: string to add to the name of the video (wihtout timestamps)</span>
<span class="sd">    folder: path to the folder in which the file has to be stored</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># if os.path.exists(path)==False:</span>
    <span class="c1">#     raise ValueError(&quot;the video %s does not exist!&quot; %path)</span>
    <span class="n">video</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">filename</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">video</span><span class="p">)</span>
    <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">filename</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">video</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;segment&#39;</span> <span class="ow">or</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;segmentation&#39;</span><span class="p">:</span>
        <span class="n">subfolder</span> <span class="o">=</span> <span class="s1">&#39;/preprocessing/segmentation/&#39;</span>
        <span class="k">if</span> <span class="n">nSegment</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nSegment</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="c1"># and before the number of the segment</span>
        <span class="k">if</span> <span class="n">hdfpkl</span> <span class="o">==</span> <span class="s1">&#39;hdf&#39;</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;segm_&#39;</span> <span class="o">+</span> <span class="n">nSegment</span> <span class="o">+</span> <span class="s1">&#39;.pkl&#39;</span>
            <span class="n">pathToSave</span> <span class="o">=</span> <span class="n">folder</span> <span class="o">+</span> <span class="n">subfolder</span> <span class="o">+</span> <span class="n">filename</span>
            <span class="n">variabletoSave</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="n">pathToSave</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">hdfpkl</span> <span class="o">==</span> <span class="s1">&#39;pkl&#39;</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;segm_&#39;</span> <span class="o">+</span> <span class="n">nSegment</span> <span class="o">+</span> <span class="s1">&#39;.pkl&#39;</span>
            <span class="n">pathToSave</span> <span class="o">=</span> <span class="n">folder</span> <span class="o">+</span> <span class="n">subfolder</span><span class="o">+</span> <span class="n">filename</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">variabletoSave</span><span class="p">,</span><span class="nb">open</span><span class="p">(</span><span class="n">pathToSave</span><span class="p">,</span><span class="s1">&#39;wb&#39;</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;trajectories&#39;</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;trajectories.pkl&#39;</span>
        <span class="n">pathToSave</span> <span class="o">=</span> <span class="n">sessionPath</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">filename</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">variabletoSave</span><span class="p">,</span><span class="nb">open</span><span class="p">(</span><span class="n">pathToSave</span><span class="p">,</span><span class="s1">&#39;wb&#39;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">subfolder</span> <span class="o">=</span> <span class="s1">&#39;/preprocessing/&#39;</span>
        <span class="k">if</span> <span class="n">hdfpkl</span> <span class="o">==</span> <span class="s1">&#39;hdf&#39;</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.pkl&#39;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variabletoSave</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">variabletoSave</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">variabletoSave</span><span class="p">,</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variabletoSave</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
                <span class="n">variabletoSave</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">variabletoSave</span><span class="p">)</span>
            <span class="n">pathToSave</span> <span class="o">=</span> <span class="n">folder</span> <span class="o">+</span> <span class="n">subfolder</span> <span class="o">+</span> <span class="n">filename</span>
            <span class="n">variabletoSave</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="n">pathToSave</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">hdfpkl</span> <span class="o">==</span> <span class="s1">&#39;pkl&#39;</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.pkl&#39;</span>
            <span class="c1"># filename = os.path.relpath(filename)</span>
            <span class="n">pathToSave</span> <span class="o">=</span> <span class="n">folder</span> <span class="o">+</span> <span class="n">subfolder</span> <span class="o">+</span> <span class="n">filename</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">variabletoSave</span><span class="p">,</span><span class="nb">open</span><span class="p">(</span><span class="n">pathToSave</span><span class="p">,</span><span class="s1">&#39;wb&#39;</span><span class="p">))</span>

    <span class="nb">print</span> <span class="s1">&#39;You just saved &#39;</span><span class="p">,</span> <span class="n">pathToSave</span>

<div class="viewcode-block" id="loadFile"><a class="viewcode-back" href="../index.html#py_utils.loadFile">[docs]</a><span class="k">def</span> <span class="nf">loadFile</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">hdfpkl</span> <span class="o">=</span> <span class="s1">&#39;hdf&#39;</span><span class="p">,</span><span class="n">sessionPath</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    loads a pickle. path is the path of the video, while name is a string in the</span>
<span class="sd">    set {}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">video</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">filename</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">video</span><span class="p">)</span>
    <span class="n">subfolder</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">if</span> <span class="n">name</span>  <span class="o">==</span> <span class="s1">&#39;segmentation&#39;</span><span class="p">:</span>
        <span class="n">subfolder</span> <span class="o">=</span> <span class="s1">&#39;/preprocessing/segmentation/&#39;</span>
        <span class="n">nSegment</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">hdfpkl</span> <span class="o">==</span> <span class="s1">&#39;hdf&#39;</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;segm_&#39;</span> <span class="o">+</span> <span class="n">nSegment</span> <span class="o">+</span> <span class="s1">&#39;.pkl&#39;</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="n">subfolder</span> <span class="o">+</span> <span class="n">filename</span> <span class="p">),</span> <span class="n">nSegment</span>
        <span class="k">elif</span> <span class="n">hdfpkl</span> <span class="o">==</span> <span class="s1">&#39;pkl&#39;</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;segm_&#39;</span> <span class="o">+</span> <span class="n">nSegment</span> <span class="o">+</span> <span class="s1">&#39;.pkl&#39;</span>
            <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="n">subfolder</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span> <span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">),</span> <span class="n">nSegmen</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;statistics&#39;</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;statistics.pkl&#39;</span>
        <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">sessionPath</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">filename</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;trajectories&#39;</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;trajectories.pkl&#39;</span>
        <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">sessionPath</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">filename</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">subfolder</span> <span class="o">=</span> <span class="s1">&#39;/preprocessing/&#39;</span>
        <span class="k">if</span> <span class="n">hdfpkl</span> <span class="o">==</span> <span class="s1">&#39;hdf&#39;</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.pkl&#39;</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="n">subfolder</span> <span class="o">+</span> <span class="n">filename</span> <span class="p">)</span>
        <span class="k">elif</span> <span class="n">hdfpkl</span> <span class="o">==</span> <span class="s1">&#39;pkl&#39;</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.pkl&#39;</span>
            <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="n">subfolder</span> <span class="o">+</span> <span class="n">filename</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="p">)</span>

    <span class="nb">print</span> <span class="s1">&#39;You just loaded &#39;</span><span class="p">,</span> <span class="n">folder</span> <span class="o">+</span> <span class="n">subfolder</span> <span class="o">+</span> <span class="n">filename</span></div>

<span class="k">def</span> <span class="nf">check_and_change_video_path</span><span class="p">(</span><span class="n">video</span><span class="p">,</span><span class="n">old_video</span><span class="p">):</span>
    <span class="n">current_video_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">video</span><span class="o">.</span><span class="n">video_path</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">old_video_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">old_video</span><span class="o">.</span><span class="n">video_path</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">old_video_session_name</span> <span class="o">=</span> <span class="n">old_video</span><span class="o">.</span><span class="n">session_folder</span>
    <span class="k">if</span> <span class="n">current_video_folder</span> <span class="o">!=</span> <span class="n">old_video_folder</span><span class="p">:</span>
        <span class="n">attributes_to_modify</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">old_video</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">old_video</span><span class="o">.</span><span class="vm">__dict__</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">old_video</span><span class="p">,</span> <span class="n">key</span><span class="p">),</span> <span class="n">basestring</span><span class="p">)</span>
        <span class="ow">and</span> <span class="n">old_video_folder</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">old_video</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">attributes_to_modify</span><span class="p">:</span>
            <span class="n">new_value</span> <span class="o">=</span> <span class="n">attributes_to_modify</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old_video_folder</span><span class="p">,</span> <span class="n">current_video_folder</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">old_video</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">new_value</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">old_video</span><span class="o">.</span><span class="n">paths_to_video_episodes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">old_video</span><span class="o">.</span><span class="n">paths_to_video_episodes</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">new_paths_to_video_episodes</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">old_video</span><span class="o">.</span><span class="n">paths_to_video_episodes</span><span class="p">:</span>
                <span class="n">new_paths_to_video_episodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old_video_folder</span><span class="p">,</span> <span class="n">current_video_folder</span><span class="p">))</span>
            <span class="n">old_video</span><span class="o">.</span><span class="n">_paths_to_video_episodes</span> <span class="o">=</span> <span class="n">new_paths_to_video_episodes</span>

        <span class="c1">### update checkpoint files</span>
        <span class="n">current_video_session_name</span> <span class="o">=</span> <span class="n">old_video</span><span class="o">.</span><span class="n">session_folder</span>
        <span class="n">folders_to_check</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;_crossings_detector_folder&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;_pretraining_folder&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;_accumulation_folder&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folders_to_check</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">old_video</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">old_video</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">folder</span> <span class="o">==</span> <span class="s1">&#39;crossings_detector_folder&#39;</span><span class="p">:</span>
                    <span class="n">checkpoint_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">old_video</span><span class="o">.</span><span class="n">crossings_detector_folder</span><span class="p">,</span> <span class="s1">&#39;checkpoint&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">checkpoint_path</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">checkpoint_path</span><span class="p">):</span>
                        <span class="n">old_video</span><span class="o">.</span><span class="n">update_tensorflow_checkpoints_file</span><span class="p">(</span><span class="n">checkpoint_path</span><span class="p">,</span> <span class="n">old_video_session_name</span><span class="p">,</span> <span class="n">current_video_session_name</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;No checkpoint found in </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span><span class="n">folder</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">sub_folder</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;conv&#39;</span><span class="p">,</span> <span class="s1">&#39;softmax&#39;</span><span class="p">]:</span>
                        <span class="n">checkpoint_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">old_video</span><span class="p">,</span><span class="n">folder</span><span class="p">),</span> <span class="n">sub_folder</span><span class="p">,</span> <span class="s1">&#39;checkpoint&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">checkpoint_path</span><span class="p">):</span>
                            <span class="n">old_video</span><span class="o">.</span><span class="n">update_tensorflow_checkpoints_file</span><span class="p">(</span><span class="n">checkpoint_path</span><span class="p">,</span> <span class="n">old_video_session_name</span><span class="p">,</span> <span class="n">current_video_session_name</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;No checkpoint found in </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">old_video</span><span class="p">,</span> <span class="n">folder</span><span class="p">),</span> <span class="n">sub_folder</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">old_video</span>

<span class="k">def</span> <span class="nf">set_load_previous_dict</span><span class="p">(</span><span class="n">old_video</span><span class="p">,</span> <span class="n">processes</span><span class="p">,</span> <span class="n">existentFile</span><span class="p">):</span>
    <span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;has_been_preprocessed&#39;</span><span class="p">,</span> <span class="s1">&#39;use_previous_knowledge_transfer_decision&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;first_accumulation_finished&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;has_been_pretrained&#39;</span><span class="p">,</span> <span class="s1">&#39;second_accumulation_finished&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;has_been_assigned&#39;</span><span class="p">,</span> <span class="s1">&#39;has_duplications_solved&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;has_crossings_solved&#39;</span><span class="p">,</span> <span class="s1">&#39;has_trajectories&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;has_trajectories_wo_gaps&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">attributes</span><span class="p">):</span>
        <span class="n">attr_value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">old_video</span><span class="p">,</span> <span class="n">attribute</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attr_value</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span>
            <span class="n">existentFile</span><span class="p">[</span><span class="n">processes</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
        <span class="k">elif</span> <span class="n">attr_value</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">existentFile</span><span class="p">[</span><span class="n">processes</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>
        <span class="k">elif</span> <span class="n">attr_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">existentFile</span><span class="p">[</span><span class="n">processes</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;-1&#39;</span>
    <span class="k">return</span> <span class="n">existentFile</span>

<div class="viewcode-block" id="getExistentFiles"><a class="viewcode-back" href="../index.html#py_utils.getExistentFiles">[docs]</a><span class="k">def</span> <span class="nf">getExistentFiles</span><span class="p">(</span><span class="n">video</span><span class="p">,</span> <span class="n">processes</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;get processes already computed in a previous session</span>
<span class="sd">    preprocessing: segmentation, fragmentation and creation of blobs and individual/global fragments</span>
<span class="sd">    knowledge_transfer: knowledge transferred from a model trained on a different video</span>
<span class="sd">    first_accumulation: first accumulation attempt</span>
<span class="sd">    pretraining: building the filters in a global-identity-agnostic way</span>
<span class="sd">    second_accumulation: accumulation by transferring knowledge from pre-training</span>
<span class="sd">    assignment: assignment of the idenitity to each individual fragment</span>
<span class="sd">    solving_duplications: solve eventual identity duplications</span>
<span class="sd">    crossings: assign identity to single animals during occlusions</span>
<span class="sd">    trajectories: compute the individual trajectories</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">existentFile</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="s1">&#39;-1&#39;</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">}</span>
    <span class="n">old_video</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">video</span><span class="o">.</span><span class="n">_previous_session_folder</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;loading old video object from get existent files&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">video</span><span class="o">.</span><span class="n">_previous_session_folder</span><span class="p">,</span> <span class="s1">&#39;video_object.npy&#39;</span><span class="p">)):</span>
            <span class="n">old_video</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">video</span><span class="o">.</span><span class="n">_previous_session_folder</span><span class="p">,</span> <span class="s1">&#39;video_object.npy&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="n">video</span><span class="o">.</span><span class="n">use_previous_knowledge_transfer_decision</span> <span class="o">=</span> <span class="n">old_video</span><span class="o">.</span><span class="n">use_previous_knowledge_transfer_decision</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;old video loaded&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;The folder </span><span class="si">%s</span><span class="s2"> is empty. The tracking cannot be restored.&quot;</span> <span class="o">%</span><span class="n">video</span><span class="o">.</span><span class="n">_previous_session_folder</span><span class="p">)</span>
            <span class="n">video</span><span class="o">.</span><span class="n">use_previous_knowledge_transfer_decision</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="n">existentFile</span><span class="p">,</span> <span class="n">old_video</span>
        <span class="n">old_video</span> <span class="o">=</span> <span class="n">check_and_change_video_path</span><span class="p">(</span><span class="n">video</span><span class="p">,</span><span class="n">old_video</span><span class="p">)</span>
        <span class="n">existentFile</span> <span class="o">=</span> <span class="n">set_load_previous_dict</span><span class="p">(</span><span class="n">old_video</span><span class="p">,</span> <span class="n">processes</span><span class="p">,</span> <span class="n">existentFile</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">video</span><span class="o">.</span><span class="n">use_previous_knowledge_transfer_decision</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="n">existentFile</span><span class="p">,</span> <span class="n">old_video</span></div>


<div class="viewcode-block" id="get_existent_preprocessing_steps"><a class="viewcode-back" href="../index.html#py_utils.get_existent_preprocessing_steps">[docs]</a><span class="k">def</span> <span class="nf">get_existent_preprocessing_steps</span><span class="p">(</span><span class="n">old_video</span><span class="p">,</span> <span class="n">listNames</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get processes already computed in a previous session</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">existentFile</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="s1">&#39;0&#39;</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">listNames</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">old_video</span><span class="o">.</span><span class="n">bkg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;has bkg&#39;</span><span class="p">)</span>
        <span class="n">existentFile</span><span class="p">[</span><span class="s1">&#39;bkg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
    <span class="k">if</span> <span class="n">old_video</span><span class="o">.</span><span class="n">ROI</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;has roi&#39;</span><span class="p">)</span>
        <span class="n">existentFile</span><span class="p">[</span><span class="s1">&#39;ROI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">old_video</span><span class="p">,</span> <span class="s1">&#39;resolution_reduction&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">old_video</span><span class="o">.</span><span class="n">resolution_reduction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;has resolution_reduction&#39;</span><span class="p">)</span>
            <span class="n">existentFile</span><span class="p">[</span><span class="s1">&#39;resolution_reduction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
    <span class="k">return</span> <span class="n">existentFile</span></div>

<div class="viewcode-block" id="getExistentFiles_library"><a class="viewcode-back" href="../index.html#py_utils.getExistentFiles_library">[docs]</a><span class="k">def</span> <span class="nf">getExistentFiles_library</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">listNames</span><span class="p">,</span> <span class="n">segmPaths</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get processes already computed in a previous session</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">existentFile</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="s1">&#39;0&#39;</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">listNames</span><span class="p">}</span>
    <span class="n">video</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="c1"># createFolder(path)</span>

    <span class="c1">#count how many videos we have</span>
    <span class="n">numSegments</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">segmPaths</span><span class="p">)</span>

    <span class="n">filename</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">video</span><span class="p">)</span>
    <span class="n">subFolders</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span><span class="s2">&quot;/*/&quot;</span><span class="p">)</span>

    <span class="n">srcSubFolder</span> <span class="o">=</span> <span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;/preprocessing/&#39;</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">listNames</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;segmentation&#39;</span><span class="p">:</span>
            <span class="n">segDirname</span> <span class="o">=</span> <span class="n">srcSubFolder</span> <span class="o">+</span> <span class="n">name</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">segDirname</span><span class="p">):</span>
                <span class="nb">print</span> <span class="s1">&#39;Segmentation folder exists&#39;</span>
                <span class="n">numSegmentedVideos</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob1</span><span class="p">(</span><span class="n">segDirname</span><span class="p">,</span><span class="s2">&quot;*.pkl&quot;</span><span class="p">))</span>
                <span class="nb">print</span>
                <span class="k">if</span> <span class="n">numSegmentedVideos</span> <span class="o">==</span> <span class="n">numSegments</span><span class="p">:</span>
                    <span class="nb">print</span> <span class="s1">&#39;The number of segments and videos is the same&#39;</span>
                    <span class="n">existentFile</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">extensions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;.hdf5&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">extensions</span><span class="p">:</span>
                <span class="n">fullFileName</span> <span class="o">=</span> <span class="n">srcSubFolder</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="n">ext</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fullFileName</span><span class="p">):</span>
                    <span class="n">existentFile</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>

    <span class="k">return</span> <span class="n">existentFile</span><span class="p">,</span> <span class="n">srcSubFolder</span></div>


<span class="k">def</span> <span class="nf">createFolder</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">timestamp</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>

    <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">folderName</span> <span class="o">=</span> <span class="n">folder</span> <span class="o">+</span><span class="s1">&#39;/preprocessing&#39;</span>
    <span class="k">if</span> <span class="n">timestamp</span> <span class="p">:</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="s1">&#39;{:%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S}_&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
        <span class="n">folderName</span> <span class="o">=</span> <span class="n">folderName</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">ts</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">folderName</span><span class="p">):</span>
        <span class="nb">print</span> <span class="s1">&#39;Preprocessing folder exists&#39;</span>
        <span class="n">subFolder</span> <span class="o">=</span> <span class="n">folderName</span> <span class="o">+</span> <span class="s1">&#39;/segmentation&#39;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">subFolder</span><span class="p">):</span>
            <span class="nb">print</span> <span class="s1">&#39;Segmentation folder exists&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">subFolder</span><span class="p">)</span>
            <span class="nb">print</span> <span class="n">subFolder</span> <span class="o">+</span> <span class="s1">&#39; has been created&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">folderName</span><span class="p">)</span>
        <span class="nb">print</span> <span class="n">folderName</span> <span class="o">+</span> <span class="s1">&#39; has been created&#39;</span>
        <span class="n">subFolder</span> <span class="o">=</span> <span class="n">folderName</span> <span class="o">+</span> <span class="s1">&#39;/segmentation&#39;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">subFolder</span><span class="p">)</span>
        <span class="nb">print</span> <span class="n">subFolder</span> <span class="o">+</span> <span class="s1">&#39; has been created&#39;</span>

<span class="k">def</span> <span class="nf">createSessionFolder</span><span class="p">(</span><span class="n">videoPath</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">getLastSession</span><span class="p">(</span><span class="n">subFolders</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">subFolders</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lastIndex</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">subFolders</span> <span class="o">=</span> <span class="n">natural_sort</span><span class="p">(</span><span class="n">subFolders</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">lastIndex</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">subFolders</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">lastIndex</span>

    <span class="n">video</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">videoPath</span><span class="p">)</span>
    <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">videoPath</span><span class="p">)</span>
    <span class="n">filename</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">video</span><span class="p">)</span>
    <span class="n">subFolder</span> <span class="o">=</span> <span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;/CNN_models&#39;</span>
    <span class="n">subSubFolders</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">subFolder</span> <span class="o">+</span><span class="s2">&quot;/*&quot;</span><span class="p">)</span>
    <span class="n">lastIndex</span> <span class="o">=</span> <span class="n">getLastSession</span><span class="p">(</span><span class="n">subSubFolders</span><span class="p">)</span>
    <span class="n">sessionPath</span> <span class="o">=</span> <span class="n">subFolder</span> <span class="o">+</span> <span class="s1">&#39;/Session_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lastIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">sessionPath</span><span class="p">)</span>
    <span class="nb">print</span> <span class="s1">&#39;You just created &#39;</span><span class="p">,</span> <span class="n">sessionPath</span>
    <span class="n">figurePath</span> <span class="o">=</span> <span class="n">sessionPath</span> <span class="o">+</span> <span class="s1">&#39;/figures&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">figurePath</span><span class="p">)</span>
    <span class="nb">print</span> <span class="s1">&#39;You just created &#39;</span><span class="p">,</span> <span class="n">figurePath</span>

    <span class="k">return</span> <span class="n">sessionPath</span><span class="p">,</span> <span class="n">figurePath</span>
</pre></div>

          </div>
        </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container container-navbar-bottom">
      <div class="spc-navbar">
        
      </div>
    </div>
    <div class="container">
    <div class="footer">
    <div class="row-fluid">
    <ul class="inline pull-left">
      <li>
        &copy; Copyright 2018, Mattia G. Bergomi, Francisco Romero Ferrero.
      </li>
      <li>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.6.
      </li>
    </ul>
    </div>
    </div>
    </div>
  </body>
</html>